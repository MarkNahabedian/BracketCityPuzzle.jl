<html>
  <head>
    <title>Mark Nahabedian's BracketCity Scores</title>
    <script src="https://d3js.org/d3.v7.js"></script>
    <script>
      document.addEventListener(
          'DOMContentLoaded',
          function () {
              let svg_elt = document.getElementById("score-graph");
              let svg_rect = svg_elt.getBoundingClientRect();
              let svg_width = svg_rect.width;
              let svg_height = svg_rect.height;
              let y_axis_offset = 30;
              let x_axis_offset = 20;
              // Load the data:
              let date_parser = d3.utcParse("%Y-%m-%d");
              (d3.tsv("my_score").then(function(data) {
                  data.forEach(function(d) {
                      d.DATE = date_parser(d.DATE);
                      d.MY_SCORE = Number(d.MY_SCORE);
                      d.CITYWIDE_AVERAGE = Number(d.CITYWIDE_AVERAGE);
                  });
                  data.sort(function(a, b) {
                      return b.DATE - a.DATE;
                  });
                  DATA = data;
                  return data;
              }).catch(function (error) {
                  console.error("Error loading my_score TSV file: ", error);
              })).then(function (data) {
                  // scales are functions which map a value in their
                  // domain to a value in their range.
                  let date_scale = d3.scaleUtc()
                      .domain([data[0].DATE, data.at(-1).DATE])
                      .range([x_axis_offset, svg_height]);
                  console.assert(date_scale(data[0].DATE) == x_axis_offset);
                  console.assert(date_scale(data.at(-1).DATE) == svg_height);
                  let score_scale = d3.scaleLinear()
                      .domain([0.0, 100.0])
                      .range([y_axis_offset, svg_width]);
                  console.assert(score_scale(0.0) == y_axis_offset);
                  console.assert(score_scale(100.0) == svg_width);
                  /*
                  console.log("date scale ",
                              data[0].DATE, date_scale(data[0].DATE),
                              data[54].DATE, date_scale(data[54].DATE));
                  console.log("score_scale ",
                              0, score_scale(0),
                              100, score_scale(100));
                              */
                  d3.axisLeft(date_scale)(d3.select("#date-axis-group"));
                  d3.axisTop(score_scale)(d3.select("#score-axis-group"));
                  // So far, so good.
                  document.getElementById("my-score-path")
                      .setAttribute("d",
                                    d3.line()
                                    .x(d => score_scale(d.MY_SCORE))
                                    .y(d => date_scale(d.DATE)) (data));
                  document.getElementById("others-score-path")
                      .setAttribute("d",
                                    d3.line()
                                    .x(d => score_scale(d.CITYWIDE_AVERAGE))
                                    .y(d => date_scale(d.DATE))(data));
              });
          });
    </script>
  </head>
  <body>
    <h1>Mark Nahabedian's BracketCity Scores</h1>
    <div>
      <svg id="score-graph" width="90%" height="500">
        <g id="score-axis-group"/>
        <g id="date-axis-group"/>
        <path id="my-score-path"/>
        <path id="others-score-path")
      </svg>
    </div>
  </body>
</html>
